@using TalentLink.Frontend.Services
@inject AuthenticationService AuthService
@inject NavigationManager Navi

@code {
    private bool navOpen = false;
    private void ToggleNav() => navOpen = !navOpen;
    private void CloseNav() => navOpen = false;
    
    private void NavigateAndClose(string url)
    {
        CloseNav();
        Navi.NavigateTo(url);
    }
    
    private async Task LogoutAndClose()
    {
        CloseNav();
        await LogoutAsync();
    }
    
    private void LoginAndClose()
    {
        CloseNav();
        NavToLogin();
    }
    
    private void RegisterAndClose()
    {
        CloseNav();
        NavToRegister();
    }
}

@if (!AuthService.IsAuthLoaded)
{
    <div>Lade Authentifizierung </div>
}
else
{
    <div class="container" @onclick="CloseNav">
        <nav @onclick:stopPropagation>
            <div class="nav-content">
                <button class="menu-toggle" @onclick="ToggleNav" aria-label="Menü öffnen/schließen">
                    <span class="bi bi-list"></span>
                </button>
                <ul class="nav-links @(navOpen ? "open" : null)" @onclick:stopPropagation>
                    <li class="nav-item"><a href="/" @onclick="@(() => NavigateAndClose("/"))">Startseite</a></li>
                    <li class="nav-item"><a href="/jobsearch" @onclick="@(() => NavigateAndClose("/jobsearch"))">Jobs finden</a></li>
                    @if (AuthService.Role == "Senior" || AuthService.Role == "Admin")
                    {
                        <li class="nav-item"><a href="/createjob" @onclick="@(() => NavigateAndClose("/createjob"))">Job anbieten</a></li>
                    }
                    <li class="nav-item"><a href="/tips" @onclick="@(() => NavigateAndClose("/tips"))">Tips und Tricks</a></li>
                    @if (AuthService.Role == "Senior" || AuthService.Role == "Student")
                    {
                        <li class="nav-item"><a href="/profile" @onclick="@(() => NavigateAndClose("/profile"))">Profil</a></li>
                    }
                    @if (AuthService.Role == "Admin")
                    {
                        <li class="nav-item"><a href="/admindashboard" @onclick="@(() => NavigateAndClose("/admindashboard"))">Dashboard</a></li>
                    }
                    @if (!AuthService.IsAuthenticated)
                    {
                        <li><button class="btn btn-outline-primary" @onclick="LoginAndClose">Login</button></li>
                        <li><button class="btn btn-primary" @onclick="RegisterAndClose">Register</button></li>
                    }
                    else
                    {
                        <li><button class="btn btn-outline-primary" @onclick="LogoutAndClose">Logout</button></li>
                    }
                </ul>
            </div>
        </nav>
    </div>
}


